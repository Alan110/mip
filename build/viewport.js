define("viewport",["require","observable","gesture"],function(e){function t(e,t){f&&n(e,t)}function n(e,t){if("object"==typeof t){var n=t.event;switch(n){case"touchstart":window.parent.postMessage(t,"*");break;case"touchmove":Math.abs(t.x)>15&&Math.abs(t.x/t.y)>=3&&!d?(e.preventDefault(),w=!0,window.parent.postMessage(t,"*")):Math.abs(t.y/t.x)>=3&&!w&&(d=!0),0!=t.y&&w&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation());break;case"touchend":window.parent.postMessage(t,"*"),w=!1,d=!1}}}function o(){var e=this.win.document;return e.scrollingElement?e.scrollingElement:e.body?e.body:e.documentElement}function r(){s++,p.fire(),u=l.getScrollLeft();var e=l.getScrollTop();0>e||(c=e)}function i(){return $(window).on("scroll",r),window.parent!==window&&platform.needSpecialScroll&&$("body").on("scroll",r),b.bind(t),l}var l={},c=null,u=null,a=null,s=0,d=!1,w=!1,f=!0,h=e("observable"),p=e("observable"),g=e("observable"),b=e("gesture");return b.init(),l.getTop=function(){return this.getScrollTop()},l.getScrollTop=function(){return c=$(window).scrollTop()},l.getScrollLeft=function(){return null==u&&(u=$(window).scrollLeft()),u},l.setScrollTop=function(e){c=null,$(window).scrollTop(e)},l.getSize=function(){return a?a:a={width:$(window).width(),height:$(window).height()}},l.getWidth=function(){return this.getSize().width},l.getScrollWidth=function(){return o.scrollWidth},l.onChanged=function(e){return h.add(e)},l.onScroll=function(e){return p.add(e)},l.onTouch=function(e){return g.add(e)},l.resetTouchZoom=function(){var e=window.innerHeight,t=window.document.documentElement.clientHeight;e&&t&&e===t||disableTouchZoom()},l.disableTouchZoom=function(){_getViewportMeta()},l.setViewportNormal=function(e){f=e},l.hasScrolled=function(){return s>0},i()});