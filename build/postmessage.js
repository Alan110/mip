define("postmessage",["require"],function(){function e(e,t,s){var i={},d=n();return s?($.extend(i,t,{type:o.TWO_WAY,sentinel:a,sessionId:d}),r[d]=$.Deferred(),i.deferTimer=setTimeout(function(){r[d].reject("timeout")},1e3)):i=t,e.postMessage(i,"*"),s&&r[d].promise()}function n(){return(1e3*+new Date+Math.ceil(1e3*Math.random())).toString(36)}function t(e,n){d[e]=n}function s(e){delete d[e]}function i(e,n){return"function"==typeof d[e]?d[e](n):void 0}var r={},d={},o={TWO_WAY:"two-way"},a="PM_REQUEST",u="PM_RESPONSE";return window.addEventListener("message",function(n){var t=n.data||{};t.type===o.TWO_WAY?t.sentinel===a?e(n.source,$.extend({},t,{sentinel:u,data:i(t.event,t)||{}}),!1):t.sentinel===u&&(t.deferTimer&&window.clearTimeout(t.deferTimer),r[t.sessionId]&&r[t.sessionId].resolve(t),delete r[t.sessionId],delete t.deferTimer):i(t.event,t)},!1),{addRequestHandle:t,deleteRequestHandle:s,sendMessage:e}});