# 哥伦布开发短线方案

> author lilangbo@baidu.com  qijian@baidu.com shenzhou@baidu.com

> Date 2016/04/07

## 短线方案说明

建议使用大搜推荐的短线方案，但不做强制要求

若垂类自己实现，需要遵守：    
1、不可以覆盖栅格化样式 栅格化文档：http://sfe.baidu.com/#/搜索基础架构/无线网页搜索/栅格化/无线栅格化    
2、速度需要达标  具体参见：http://speedup.baidu.com/help/procedure    
3、长线方案上线后需要各垂类整体迁移

垂类自己实现的问题和风险：    
1、迁移到长线方案成本会比较高，长线方案预期4月末会上线。到时所有哥伦布卡片都需要迁移至长线方案。相对来说短线方案迁移至长线方案成本会小很多。    
2、搜索结果页整体升级，不会考虑垂类自己实现的哥伦布样式。需要垂类自己承担，高优解决。    
3、统计问题需要垂类找ubs单独勾兑，但需要遵守现有统计规范

# 推荐的短线方案

## 开发工具：平台开发——编译到测试机

平台开发和预览参照:http://sfe.baidu.com/#/阿拉丁/圣玛利亚平台/使用手册

## 整体原理

主模板使用阿拉丁模板santa,通过santa来选择各个哥伦布子模板，子模板在平台哥伦布子卡中新建，主题栅格样式、统一机制等主模板控制


## 开发模板方法

子卡开发与普通阿拉丁很相似，后续迁移到长线方案成本不会很大。

### smarty和普通的模板开发类似

```
{%* 区别在于 $santaData 相当于普通阿拉丁的 $alaData *%}
{%* 比如子卡的位置 *%}
{%$santaData.iteration|escape%}

```

### js模块有不同，代码示例如下

```

// 注意是Sa.setup
Sa.setup({
	data: 'test_word'
});
Sa.setup(function () {
	console.log(this.data.data);
    csosole.log(this.parent);
});

```

```

{%* $santaData.card_order 表示当前模板处于当前分类的第几个，如果是'1'，会默认在子卡的顶部加上空白间距。 *%}
{%* 一般需要由数据提供，模板开发时，可以在 data_modifier 里设置为 1 看效果。    
联调时应该由数据提供card_order，如果RD不清楚怎么设定。可以联系 @郑宽 *%}
{%$santaData.card_order = '1'%}

```


```
# tplmake.sh编译多个卡片
# : 表示目录   ; 两个目录间的分隔符 , 模板的分隔符
sh tplmake.sh "santa:sa_xx1,sa_xx2;searchaladdin:test1,test2"
```

## 资源引入方式

	统一接入ae，RD OWNER：董立强

    主卡模板名 santa，模板id 8297

    不需要在 http://pm.open.baidu.com:8001/ 新增卡片和主卡


## 展开收起状态——配置

平台测试地址：http://cp01-aladdin-platform-06.epc.baidu.com:8129/audit/wisesigma/gotoSigmaIntervene/ids/241521

```

// 子卡的展开收起策略（仅在哥伦布垂类模板下生效）。可选字段
"hideCard": {  挪到数据----先不启用 
    //  从第几位开始隐藏卡片。整数，取值范围大于等于 2。
    "startIndex": 2, 
    //   展开按钮文案。字数2-15。
    "showTip": "展开xxx"
    //   收起按钮文案
    "hideTip": "收起xxx"
}

```

### 强弱展现

目前部分需求在展开和收起两种状态下，子卡的展现样式会有区别。为了满足这种需求。

主模板会在最外层的容器上加上 wa-santa-onhalf。子卡可根据class来完成样式的切换。    
另外子卡有JS需求，也可以在 this 中绑定 onchange 事件。当主卡切换状态时，会触发子卡的 onchange

```

Sa.setup(function () {
    this.onchange = function (status) {
        // true 或 false。true 表示展开状态，false 表示收起状态。
        console.log(status);
    };
});

```

## 子卡数据源来自多个资源的数据格式说明

目前有一部分哥伦布子卡需要用到几个资源的数据，    
由于之前 tplData 变成一个数组之后，会造成模板数据结构不统一。     
跟RD商订后，模板中的 tplData 跟普通模板一致，扩展字段统一放至 extend_data。


1、变更前：    
```
tplData: [    
    {}, // 第一个资源数据    
    {}, // 第二个资源数据    
    {}, // ...    
]
```

2、变更后:    
```
tplData: {    
    "url": "http://www.baidu.com",    
    "name": "刘德华",    
    "image": "http://t11.baidu.com/xxx",    
    "extend_data": [    
        {}, // 第一个扩展资源数据    
        {}  // 第二个扩展资源数据    
    ]    
}
```
新增的哥伦布子卡，如果卡片的数据来源于多个资源。数据格式默认使用第2种。
PS：这种数据方案属于极短线方案，长线方案已经在推进中，后续模板只针对单个资源开发。

## sigma配置详解（请联系pm郭菲菲配置）

	wiki配置解释地址：http://wiki.baidu.com/pages/viewpage.action?pageId=175020599

    Wiki平台操作地址：http://wiki.baidu.com/pages/viewpage.action?pageId=184277506

	平台地址：http://pm.open.baidu.com:8090/data/pm.php
        位置：wise平台化=》sigma配置管理

配置情况梳理：
	
	1、皮肤配置不和其他任何有耦合，可以按需随意配置，分三块：header区、提示区、和底部条区

	2、bgcolor会默认给大卡加上背景色，bgimg会默认给c-onlyshow-toppic这个dom节点默认加上背景图片

	3、hideOtherResult（隐藏页面其他结果）为true且toolbar（是否需要公共的底部条，即分享、反馈那块）为true是有上拉动画，如北京天气

	4、hideOtherResult为true  toobar false  则为隐藏9条结果，下面会有展开其他结果的功能，此情况fullScreen应该为false，即不全屏展现。如下图：

<p class="image"><img src="./img/fold.png"></p>

	5、fullScreen是否需要撑满全屏



	具体配置信息

```

"sigma": {
    // 页面头部皮肤    字段取值： default（使用线上头部）、dark（深色文字）、light（白色文字）。默认值为light。必须
    "header_skin": "light",
    // tip区域皮肤  字段取值：  dark（深色文字）、light（白色文字）。默认值light。必须
    "tip_skin": "light",
    // 底部工具条区域皮肤  字段取值：  dark（深色文字）、light（白色文字）。默认值light。必须
    "bar_skin": "light",
    // 背景色。格式 # + 6位十六进制数字。取值范围从 #000000 至 #ffffff。可选字段。
    "bgcolor": "#ffffff",
    // 默认背景图片地址。图片链接。可选
    "bgimg": "http://t11.baidu.com/xxx", 图片要求去充gips
    // 当低于一定高度时，背景图替换为 bgimg_small。图片链接。可选
    "bgimg_small": "http://t11.baidu.com/xxx",  挪到数据

    // 是否隐藏其它结果。true（隐藏其它结果）、false（不隐藏）。默认值为false。必须
    "hideOtherResult": false,
    // 是否开启模板占满全屏策略，如果开启，则未占满一屏的模板会把拉抻至全屏。true（开启占满全屏）、false（关闭）。默认值为false。必须
    "fullScreen": false,
     // 是否展现模板底部工具条（反馈、分享）。true（展现）、false（关闭）。默认值为false。必须
    "toolbar": false,

    // 子卡的展开收起策略（仅在哥伦布垂类模板下生效）。可选字段
    "hideCard": {  挪到数据----先不启用 
        //  从第几位开始隐藏卡片。整数，取值范围大于等于 2。
        "startIndex": 2, 
        //   展开按钮文案。字数2-15。
        "showTip": "展开xxx"
        //   收起按钮文案
        "hideTip": "收起xxx"
    }
}

```

## sigma开发

不用关心文件名，有配置自然会走sigma机制，都继承c_base模板

## sigma线下联调

US增加一个配置文件:目录/home/work/search/us/conf 文件名 sigma_exeunt

取值示例：

```
    {"header_skin":"light","tip_skin":"light","bar_skin":"light","bgcolor":"#333333","hideOtherResult":"true","fullScreen":"true","toolbar":"false","bgimg":"https://ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/image/pic/item/3bf33a87e950352af4ae37d65543fbf2b3118b24.jpg"}}} 
```

修改后重启US

## 哥伦布短线方案中的sigma背景图

如果背景图需要做 key 级别的，即每个query不一样，需要提交一份背景图资源来处理。       
FE需要做的：建一个虚拟模板和一份schema，schema里有bgimg 字段。    
数据由RD提供和配置，如果RD不清楚怎么弄可以联系接口人：郑宽    
数据提供后，在sigma场景下，该数据会自动展现为sigma背景图。


## 长线方案

整体上线时间4月下旬，短线的哥伦布项目需要做迁移。

长线方案开发方式和普通阿拉丁一样，只是在后端组织数据上会做处理
