define("builtins/mip-img",["../utils/util","customElement"],function(){function t(t){var i=+t.oWid,e=+t.oHei,o=$(window),n=o.width(),r=Math.round(n*e/i),s=(o.height()-r)/2;return{wid:n,hei:r,left:0,top:s}}var i=require("customElement"),e=function(){if(!this.isRender){this.isRender=!0;var i=new Image,e=this.getAttribute("src");if(i.src=e,this.getAttribute("alt")&&i.setAttribute("alt",this.getAttribute("alt")),this.insertBefore(i,this.firstChild),""===$(this).attr("popup")||"popup"===$(this).attr("popup")){var o=['<div class="mip-img-popUp-wrapper">','<div class="mip-img-popUp-bg"></div>','<img src="'+e+'" />',"</div>"].join(""),n=$(i),r=($(this),$(o).insertAfter(n)),s=r.find(".mip-img-popUp-bg"),a=r.find("img"),p=400;r.on("click",function(){s.fadeOut(p);var t=n.offset().left,i=n.offset().top-$(window).scrollTop();a.animate({left:t,top:i,width:n.width(),height:n.height()},p,function(){r.hide()})}),n.on("click",function(){var e=i.width,o=i.height,d=t({oWid:e,oHei:o}),l=n.offset().left,u=n.offset().top-$(window).scrollTop();a.css({left:l,top:u,width:n.width(),height:n.height()}),s.show(),r.show(),a.animate({left:d.left,top:d.top,width:d.wid,height:d.hei},p)})}}};return i.prototype.init=function(){this.build=e},i}),define("builtins/mip-gif",["require","customElement"],function(t){function i(){if(!this.isRender){this.isRender=!0;var t=new Image,i=this.getAttribute("src");t.src=i,this.getAttribute("width")&&t.setAttribute("width",this.getAttribute("width")),this.getAttribute("height")&&t.setAttribute("height",this.getAttribute("height")),this.getAttribute("srcset")&&t.setAttribute("srcset",this.getAttribute("srcset")),this.getAttribute("sizes")&&t.setAttribute("sizes",this.getAttribute("sizes")),this.appendChild(t),$(t).on("click",function(){var t=this.parentNode,i=t.getAttribute("src"),e=new Image;_this=this,e.onload=function(){t.removeChild(_this),t.appendChild(this),_this=null},e.src=i})}}var e=t("customElement");return e.prototype.init=function(){this.build=i},e}),define("builtins/mip-pix",["require","customElement"],function(t){function i(){if(!this.isRender){this.isRender=!0;var t=new Image,i=this.getAttribute("src"),e=this.getAttribute("proxy-title"),o=(new Date).getTime(),n="";i=e?n+"?t="+o+"&title="+e+"&host=mip.bdstatic.com&from=baidu":n+"?t="+o,t.src=i,t.setAttribute("width",0),t.setAttribute("height",0),this.setAttribute("width",""),this.setAttribute("height",""),this.appendChild(t)}}var e=t("customElement");return e.prototype.init=function(){this.build=i,this.inviewCallback=function(){},this.mipAttachedCallback=function(){this.build()}},e}),define("extensions/mip-carousel",["require","customElement","gesture"],function(t){var i=t("customElement"),e=function(){function i(t){l=setTimeout(function(){m(!0).then(function(){i(t)})},t)}if(!this.isRender){this.isRender=!0;var e=$(this),o=e.attr("height"),n=e.attr("width");if(n&&o&&"number"==typeof+o&&"number"==typeof+n){var r=+o/+n*100+"%";e.css("padding-bottom",r);var s=e.children();if(!(s.length<2)){var a=0,p=-9999,d=800;s.css({position:"absolute",left:p,top:0}),s.eq(a).css("left",0);var l,u,c=!1,h=!1,m=function(t){var i=t?a+1:a-1;0>i?i=s.length-1:i>=s.length&&(i=0);var o=e.width(),n=(t?1:-1)*o;s.filter(function(t){return t!==a&&t!==i}).css("left",p),s.css({display:"block",opacity:1,"z-index":1}),s.eq(i).css({left:n,"z-index":2});var r=$.Deferred();return h=!0,s.eq(i).animate({left:0},d,function(){a=i,c?r.reject():r.resolve(),h=!1}),s.eq(a).fadeOut(d),r.promise()},v=!1;("autoplay"===e.attr("autoplay")||""===e.attr("autoplay"))&&(u="number"==typeof+this.getAttribute("defer")?+this.getAttribute("defer"):2e3,v=!0,i(u));var f=t("gesture");f.init(),f.bind(function(t,e){if("touchend"===e.event&&Math.abs(e.x)>Math.abs(e.y)&&!h){l&&clearTimeout(l);var o=!(e.x>0);m(o).then(function(){v&&i(u)})}}),v&&(e.delegate("mip-img","click",function(){("popup"===$(this).attr("popup")||""===$(this).attr("popup"))&&(l&&clearTimeout(l),c=!0)}),e.delegate(".mip-img-popUp-wrapper","click",function(){return i(u),c=!1,!1}))}}}};return i.prototype.init=function(){this.build=e},i}),define("extensions/mip-iframe",["require","customElement"],function(t){var i=t("customElement"),e=function(){if(!this.isRender){this.isRender=!0;var t=$(this),i=t.attr("src");t.attr("srcdoc")&&(i="data:text/html;charset=utf-8;base64,"+window.btoa(t.attr("srcdoc")));var e=t.attr("height"),o=t.attr("width");if(i&&o&&e){if(e&&o&&"number"==typeof+e&&"number"==typeof+o){var n=+e/+o*100+"%";t.append('<div style="padding-bottom: '+n+';"></div>')}var r=$('<iframe frameBorder="0" scrolling="no"></iframe>');r.attr("src",i),""===t.attr("allowfullscreen")&&r.attr("allowfullscreen",""),"true"===t.attr("allowtransparency")&&r.attr("allowtransparency","true");var s=t.attr("sandbox");(s||""===s)&&r.attr("sandbox",s),t.append(r)}}};return i.prototype.init=function(){this.build=e},i}),define("builtins/mip-appdl",["require","customElement"],function(t){function i(){this.isRender||(this.isRender=!0,e.call(this),s.call(this))}function e(){var t=this.getAttribute("tpl");switch(t){case"imageText":o.call(this);break;case"noneImg":n.call(this)}}function o(){var t=r.call(this),t=r.call(this),i=$(this).attr("downbtntext"),e=$(this).attr("downsrc"),o=$(this).attr("imgsrc"),n="'mip-appdl-box mip-appdl-"+$(this).attr("postiontye")+"'",s="<div class= "+n+" ><div class='mip-appdl-content'><div class='mip-appdl-contentcell'><img src="+o+" class='mip-appdl-downimg'></div><div class='mip-appdl-textbox mip-appdl-contentcell'>"+t+"</div><div class='mip-appdl-downloadbbutton mip-appdl-contentcell'><a herf="+e+">"+i+"</a></div><div class='mip-appdl-closebutton'></div></div></div>";$(this).append(s)}function n(){var t=r.call(this),i=$(this).attr("downbtntext"),e=$(this).attr("downsrc"),o="'mip-appdl-box mip-appdl-"+$(this).attr("postiontye")+"'",n="<div class= "+o+" ><div class='mip-appdl-content'><div class='mip-appdl-textbox mip-appdl-contentcell'>"+t+"</div><div class='mip-appdl-downloadbbutton mip-appdl-contentcell'><a herf="+e+">"+i+"</a></div><div class='mip-appdl-closebutton'></div></div></div>";$(this).append(n)}function r(){var t=$(this).attr("texttip"),i=[];if(t)try{i=new Function("return "+t)()}catch(e){}for(var o="<div class='mip-appdl-text'>",n=i>2?2:i.length,r=0;n>r;r++)o+="<p>"+i[r]+"</p>";return o+"</div>"}function s(){$(this).on("click",".mip-appdl-closebutton",function(){$(this).parents(".mip-element").remove()})}var a=t("customElement");return a.prototype.init=function(){this.build=i},a}),define("builtins/img-viewer",["deps/emit"],function(t){function i(t){this.opt=$.extend({selector:"[data-carousel]",viewerClass:".mip-viewer",timeoutHideHeader:3e3,verticalThreshold:.2,horizontalThreshold:.2,maxShowItem:3},t),this.init(),this.createDom(),this.bindEv()}var e=$(window),o={width:e.width(),height:e.height()};return $.extend(i.prototype,{init:function(){this.imgs=$(this.opt.selector),this.urlList=[],this.wrapper=$(this.opt.viewerClass),this.wrapper.length||(this.wrapper=$('<div class="mip-viewer"/>'),$("body").append(this.wrapper)),this.updateDirection()},createDom:function(){var t='<div class="mip-viewer-header"><a href="javascript:;" class="mip-viewer-header-ret"><i class="c-icon">&#xe783</i></a><div class="mip-viewer-header-inner"><span class="mip-viewer-header-txt"></span></div></div>',i='<div class="mip-viewer-viewer"><div class="mip-viewer-list mip-viewer-normal">',e='<div class="mip-viewer-item"><div class="mip-viewer-item-inner"><img src="" /></div></div>',o="</div></div>",n="";this.updateList(),n+=t,n+=i;for(var r=0,s=this.opt.maxShowItem;s>r;r++)n+=e;n+=o,this.wrapper.html(n),this.viewer=this.wrapper.find(".mip-viewer-viewer"),this.list=this.viewer.find(".mip-viewer-list"),this.items=this.list.find(".mip-viewer-item"),this.header=this.wrapper.find(".mip-viewer-header"),this.pager=this.header.find(".mip-viewer-header-txt"),this.ret=this.header.find(".mip-viewer-header-ret")},show:function(){var t=this;window.parent.postMessage({event:"jqHandle",data:{selector:".sf-header",handle:"hide"}},"*"),$(".main").hide(0,function(){e.trigger("resize"),t.wrapper.height(o.height).show(),t.replaceDom(t.getShowList(t.carouselId))}),this.updatePager(),this.hideHeader()},hide:function(){this.wrapper.hide(),$(".main").show(),window.parent.postMessage({event:"jqHandle",data:{selector:".sf-header",handle:"show"}},"*")},updateDirection:function(){var t="mip-viewer-horizon";o.width>o.height?(this.phoneDirection="horizontal",this.wrapper.addClass(t)):(this.phoneDirection="vertical",this.wrapper.removeClass(t))},getShowList:function(t){var i=[];return i.push({src:this.urlList[t-1]||""}),i.push({src:this.urlList[t]}),i.push({src:this.urlList[t+1]||""}),i},replaceDom:function(t){this.items.each(function(i){var e=$(this).find("img");e.removeAttr("style").attr("src",t[i].src),!t[i].src&&e.hide()})},showHeader:function(){this.headerTimer&&window.clearTimeout(this.headerTimer),this.header.show(),this.hideHeader()},hideHeader:function(){var t=this;this.headerTimer=setTimeout(function(){t.header.hide()},this.opt.timeoutHideHeader)},updatePager:function(){this.pager.text(this.carouselId+1+"/"+this.urlList.length)},updateList:function(t){var i=t||this.imgs,e=this;e.urlList.length=0,i.each(function(t){var i=$(this);e.urlList.push(i.attr("src")),i.attr("carouselId",t)})},bindEv:function(){function t(t){t.preventDefault()}var i,n,r=this;this.imgs.on("click",function(){var t=$(this),i=t.attr("carouselId");r.carouselId=+i,r.show()}),this.ret.on("click",function(){return r.hide(),!1}),this.viewer.on("click",function(){r.showHeader()}),this.viewer.on("touchstart",function(t){r.locked=!!r.animationStatus,r.locked||(i=t.originalEvent.touches[0].pageX,n=r.list.css("-webkit-transform").match(/(-?[0-9\.]+)/g),r.initTransX=n&&+n[4]||0)}).on("touchmove",function(e){if(!r.locked){var o=e.originalEvent.touches[0].pageX,n=o-i+r.initTransX;t(e),r.list.css({"-webkit-transition-duration":"0s","-webkit-transform":"translateX("+n+"px)"})}}).on("touchend",function(t){if(!r.locked){var e=t.originalEvent.changedTouches[0].pageX,n=e-i,s=Math.abs(n)>o.width*r.opt[r.phoneDirection+"Threshold"];s?n>0?r._goPrev():r._goNext():r._goNormal()}}).on("touchcancel",function(){}),this.list.on("transitionend webkitTransitionEnd",function(){r.replaceDom(r.getShowList(r.carouselId)),r._goCommon(),r.animationStatus="",r.updatePager()}),e.on("viewport_resize.img_viewer",function(t,i){o=i,r.updateDirection(),r.wrapper.height(o.height)})},stop:function(){},_goNormal:function(){this.animationStatus="_goNormal",this.list.css({"-webkit-transition-duration":"400ms","-webkit-transform":"translateX(-33.33%)"})},_goNext:function(){return this.animationStatus="_goNext",this.urlList[this.carouselId+1]?(this.list.removeAttr("style").addClass("mip-viewer-toright"),void this.carouselId++):void this._goNormal()},_goPrev:function(){return this.animationStatus="_goPrev",this.urlList[this.carouselId-1]?(this.list.removeAttr("style").addClass("mip-viewer-toleft"),void this.carouselId--):void this._goNormal()},_goCommon:function(){this.list.removeAttr("style").removeClass("mip-viewer-toright mip-viewer-toleft")},destroy:function(){}},t.prototype),i}),define("builtins/mip-video",["utils/util","customElement","builtins/video/player"],function(){var t,i=require("customElement"),e=require("builtins/video/player"),o=function(){if(!this.isRender){this.isRender=!0;var i=this,o=$(this);$(this).on("click",function(){t&&t.remove(),t=new e({});var n=o.attr("container");n=n&&$(n)&&$(n).length?$(n):i;var r=($(n).parent().find("mip-video"),[]),s=o.attr("adInfo");if(s)try{r=new Function("return "+s)()}catch(a){}var p=o.find("source"),d=[];p.each(function(){var t=$(this).attr("src"),i=$(this).attr("type");t&&d.push({type:i,src:t})}),t.render({container:n,height:o.attr("height"),width:o.attr("width"),src:o.attr("src"),type:o.attr("type"),poster:o.attr("poster"),autoplay:o.attr("autoplay"),controls:o.attr("controls"),loop:o.attr("loop"),muted:o.attr("muted"),android:{playMode:o.attr("android-mode")||""},ios:{playMode:o.attr("ios-mode")||""},adInfo:r,playInfo:d})}),$(this).on("click","video",function(t){t.stopPropagation(),t.preventDefault()})}};return i.prototype.init=function(){this.build=o},i}),define("builtins/video/player",["require"],function(t){function i(t){this.params=$.extend(!0,{container:null,height:null,width:null,src:null,type:null,poster:null,autoplay:null,controls:null,loop:null,muted:null,ios:{playMode:!1},android:{playMode:!1},adInfo:[],playInfo:[]},t),this.box={normal:$('<div class="mip-video-box"></div>'),hide:$('<div class="mip-video-box-ios"></div>')},this.adIdx=0,this.lastTime=0,this.eventNS=".mipvideo",this.init(),this.bindEvents()}return i.prototype={constructor:i,tplSource:["<% for (var i = 0, len = data.length; i < len; i++) { var item = data[i]; %>",'<source <%=(item.type ? "type=" + item.type : "")%> src="<%=item.src%>"></source>',"<% } %>"].join(""),tmpl:function(){var t={},i=function e(i,o){var n=/\W/.test(i)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+i.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)’/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):t[i]=t[i]||e(document.getElementById(i).innerHTML);return o?n(o):n};return i}(),init:function(){var t=this;t.$video=$("<video></video>"),t.video=t.$video[0],t.video.className="mip-video-player",t.isWorking=!1},initParams:function(){var t=this;t.lastTime=0},render:function(t){var i=this;this.options=$.extend({},i.params,t),i.setAttrs(),i.loadSource(),i.appendVideo(),i.play(),i.isWorking=!0},setAttrs:function(){var t=this,i=t.options;t.setAttr("width",i.width),t.setAttr("height",i.height),t.setAttr("poster",i.poster),t.setAttr("autoplay",i.autoplay),t.setAttr("controls",i.controls),t.setAttr("loop",i.loop),t.setAttr("muted",i.muted)},setAttr:function(t,i){var e=this,o=e.$video;i||0===i||""===i?o.attr(t,i):o.removeAttr(t)},appendVideo:function(){var t=this,i=t.$video,e=t.options,o=$(e.container);if(o.length){if(t.isIos()&&e.ios&&"hide"===e.ios.playMode){var n=t.box.hide.html(i);return void o.append(n)}return!t.isIos()&&e.android&&"fullscreen"===e.android.playMode?void t.fullscreenForAndriod():void o.append(this.box.normal.html(i))}},play:function(){var t=this,i=/(iphone.+mqqbrowser)|(android.*(baidubrowser)|(baiduboxapp))/i;navigator.userAgent.match(i)?setTimeout(function(){t.video.play()},30):t.video.play()},load:function(){this.video.load()},loadSource:function(){{var t=this,i=t.options;t.video}t.initParams(),t.removeEventsForAD(),t.hasAd(i)?t.playForAD(i):t.playForNormal(i),t.load()},playForNormal:function(){{var t=this,i=t.options,e=i.playInfo;t.video}e&&e.length||(e=[],e[0]={type:i.type,src:i.src}),t.appendSource(e)},playForAD:function(){{var t=this,i=t.options,e=i.adInfo;t.video}t.hasAd(i)&&(t.appendSource(e[t.adIdx]),t.adIdx++,t.eventsForAD())},eventsForAD:function(){var t=this,i=t.eventNS+"forad",e=t.video;t.removeEventsForAD(),t.$video.on("timeupdate"+i,function(){var i=Math.ceil(e.currentTime),o=t.getVideoTime();return i-t.lastTime>2?(e.currentTime=t.lastTime,t.lastTime=t.lastTime,void t.play()):(t.lastTime=i,void(o&&i>=o&&(t.loadSource(),t.play())))})},removeEventsForAD:function(){var t=this,i=t.eventNS+"forad";t.$video.off("timeupdate"+i)},hasAd:function(){var t=this,i=t.options,e=i.adInfo;return!e||!e.length||t.adIdx>=e.length?!1:!0},appendSource:function(t){var i=this,e=i.$video,o=this.tmpl(this.tplSource,{data:t});o&&e.html(o)},isIos:function(){return/iPhone|iPad|iPod/i.test(window.navigator.userAgent)},bindEvents:function(){var t=this;t.$video.on("loadeddata",function(){t.video.play()})},fullscreenForAndriod:function(){var i=this,e=i.$video,o=i.options,n=i.eventNS+"fullscreen";t(["builtins/video/popup"],function(t){var r=new t({title:o.title||"",content:"",fullView:!0,customClassName:"mip-video-player-popup",onOpen:function(){r.$popupContent.html(e),i.setVideoCenterForFullscreen()},onClose:function(){$(window).off("orientationchange"+n),i.initStyle()}}),s=$(".mip-video-player-popup .mip-video-popup-remove");s.length&&s.off("click"+n).on("click"+n,function(){r.$popupContent.length&&r.$popupContent.html("")})})},initStyle:function(){var t=this,i=t.$video;i.removeAttr("style")},setVideoCenterForFullscreen:function(){var t=this,i=t.eventNS+"fullscreen",e=0,o=$(".mip-video-player-popup .mip-video-popup-remove");o.length&&(e=o.height()+o.offset().top),$(window).off("orientationchange"+i+" resize"+i).on("orientationchange"+i+" resize"+i,function(){t.calculateVideo({freesize:e})}),t.calculateVideo({freesize:e})},calculateVideo:function(t){var i=this,e=i.$video,t=t||{};i.initStyle(),setTimeout(function(){var i=$(window).height(),o=$(window).width(),n=t.freesize||0,r=e.height();o>=i&&(r=i-2*n),e.css({height:r+"px","margin-top":-r/2+"px",visibility:"visible"})},10)},pause:function(){this.video.pause()},remove:function(){this.$video.parent().remove(),this.isWorking=!1},getVideoTime:function(){return Math.ceil(this.video.duration)},on:function(t,i){this.$video.on(t,i)},off:function(t,i){this.$video.off(t,i)},trigger:function(t){this.$video.trigger(t)}},i}),define("builtins/video/popup",["require"],function(){var t=function(t){var i=this;i.options=$.extend({title:"",content:"",fullView:!1,duration:400,customClassName:"",onOpen:function(){},onClose:function(){}},t),i._init()};return t.prototype={constructor:t,version:"0.0.1",_init:function(){var t=this;t._preparePopupWrapper(),t._stopScroll(),t.popup()},_preparePopupWrapper:function(){var t=this,i=$(".mip-video-popup-wrapper");i.length?(t.$popupFrame=i,t.$popupFrame.empty()):(t.$popupFrame=$('<div class="mip-video-popup-wrapper"></div>'),$(document.body).append(t.$popupFrame))},_stopScroll:function(){var t=this;t.$popupFrame.on("touchmove",function(t){t.preventDefault()})},_bindEvent:function(){var t=this;t.$popupFrame.on("click",".mip-video-popup-mask,.mip-video-popup-remove",function(){t.closePopup()})},_randerContent:function(){var t=this;if(t.$popupMask=$('<div class="mip-video-popup-mask"></div>'),t.$popupModal=$('<div class="mip-video-popup-modal"></div>'),t.$popupContent=$('<div class="mip-video-popup-content"></div>'),t.$popupHead=$('<div class="mip-video-popup-head"></div>'),t.options.title){var i=$('<div class="mip-video-popup-title"></div>');i.append(t.options.title),t.$popupHead.append(i)}var e=$('<div class="mip-video-popup-remove">X</div>');t.$popupHead.append(e),t.$popupContent.append(t.options.content),t.$popupModal.append(t.$popupHead).append(t.$popupContent).addClass(t.options.customClassName),t.$popupFrame.append(t.$popupModal).append(t.$popupMask)},popup:function(){var t=this,i=$(window).height();t._randerContent(),t._bindEvent(),t.$popupMask.show().animate({opacity:1},"fast","linear"),t.$popupModal.show();var e=t.$popupModal.height();(t.options.fullView||e>i)&&t.$popupModal.height("100%"),t.$popupModal.animate({"-webkit-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)"},t.options.duration,"linear",function(){$(this).css({"-webkit-transform":"none",transform:"none"}),t.options.onOpen()})},closePopup:function(){var t=this;t.$popupModal.animate({"-webkit-transform":"translate3d(0, 100%, 0)",transform:"translate3d(0, 100%, 0)"},t.options.duration,"linear",function(){$(this).css({"-webkit-transform":"none",transform:"none"}).hide(),t.options.onClose(),t._destroy()}),t.$popupMask.animate({opacity:0},"fast","linear",function(){$(this).hide()})},_destroy:function(){var t=this;t.$popupFrame.off("click",".mip-video-popup-mask,.mip-video-popup-remove"),t.$popupFrame.empty()}},t}),define("builtins/mip_builtins",["require","gesture","viewport","registerMipElement","builtins/mip-pix","builtins/mip-gif","builtins/mip-img","extensions/mip-carousel","extensions/mip-iframe","builtins/mip-video"],function(t){window.MIP={},MIP.css={};var i=t("gesture");i.init();var e=t("viewport");t("registerMipElement"),MIP.registerMipElement("mip-pix",t("builtins/mip-pix")),MIP.registerMipElement("mip-gif",t("builtins/mip-gif")),MIP.registerMipElement("mip-img",t("builtins/mip-img")),MIP.registerMipElement("mip-carousel",t("extensions/mip-carousel")),MIP.registerMipElement("mip-iframe",t("extensions/mip-iframe")),MIP.registerMipElement("mip-video",t("builtins/mip-video")),$(function(){window.setTimeout(function(){$(".mip-element").each(function(){this.inviewCallback()})},100)}),e.onScroll(function(){$(".mip-element").each(function(){this.inviewCallback()})}),window.parent!==window&&(platform.needSpecialScroll&&$("body,html").css({height:"100%",overflow:"auto","-webkit-overflow-scrolling":"touch"}),window.parent.postMessage({event:"mippageload",data:{time:(new Date).getTime()}},"*"))}),require(["builtins/mip_builtins"]);